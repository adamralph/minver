<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <MSBuildAllProjects Condition="'$(MSBuildAssemblyVersion)' == '' Or '$(MSBuildAssemblyVersion)' &lt; '16.0'">$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>
    <GetPackageVersionDependsOn>$(GetPackageVersionDependsOn);MinVer</GetPackageVersionDependsOn>
  </PropertyGroup>

  <Target Name="MinVer_GetVersion" Condition="'$(MinVerVersionOverride)' == ''">
    <ItemGroup>
      <MinVerInputs Include="--build-metadata &quot;$(MinVerBuildMetadata)&quot;" />
      <MinVerInputs Include="--major-minor &quot;$(MinVerMajorMinor)&quot;" />
      <MinVerInputs Include="--repo &quot;$(MSBuildProjectDirectory)&quot;" />
      <MinVerInputs Include="--tag-prefix &quot;$(MinVerTagPrefix)&quot;" />
      <MinVerInputs Include="--verbosity &quot;$(MinVerVerbosity)&quot;" />
    </ItemGroup>
    <Exec Command="dotnet &quot;$(MSBuildThisFileDirectory)../minver/MinVer.dll&quot; @(MinVerInputs->'%(Identity)', ' ')" ConsoleToMSBuild="true">
      <Output TaskParameter="ConsoleOutput" ItemName="MinVerConsoleOutput" />
    </Exec>
    <ItemGroup>
      <MinVerOutputVersion Include="@(MinVerConsoleOutput)" Condition="'$([System.String]::new(`%(Identity)`).StartsWith(`Version:`))' == 'true'" />
      <MinVerOutputVersionPrefix Include="@(MinVerConsoleOutput)" Condition="'$([System.String]::new(`%(Identity)`).StartsWith(`VersionPrefix:`))' == 'true'" />
      <MinVerOutputVersionSuffix Include="@(MinVerConsoleOutput)" Condition="'$([System.String]::new(`%(Identity)`).StartsWith(`VersionSuffix:`))' == 'true'" />
      <MinVerOutputMajor Include="@(MinVerConsoleOutput)" Condition="'$([System.String]::new(`%(Identity)`).StartsWith(`Major:`))' == 'true'" />
      <MinVerOutputMinor Include="@(MinVerConsoleOutput)" Condition="'$([System.String]::new(`%(Identity)`).StartsWith(`Minor:`))' == 'true'" />
      <MinVerOutputPatch Include="@(MinVerConsoleOutput)" Condition="'$([System.String]::new(`%(Identity)`).StartsWith(`Patch:`))' == 'true'" />
    </ItemGroup>
    <PropertyGroup>
      <MinVerVersion>@(MinVerOutputVersion->Substring(8))</MinVerVersion>
      <MinVerVersionPrefix>@(MinVerOutputVersionPrefix->Substring(14))</MinVerVersionPrefix>
      <MinVerVersionSuffix>@(MinVerOutputVersionSuffix->Substring(14))</MinVerVersionSuffix>
      <MinVerMajor>@(MinVerOutputMajor->Substring(6))</MinVerMajor>
      <MinVerMinor>@(MinVerOutputMinor->Substring(6))</MinVerMinor>
      <MinVerPatch>@(MinVerOutputPatch->Substring(6))</MinVerPatch>
    </PropertyGroup>
  </Target>

  <Target Name="MinVer_OverrideVersion" BeforeTargets="MinVer_GetVersion" Condition="'$(MinVerVersionOverride)' != ''">
    <Message Text="MinVer: Using version override $(MinVerVersionOverride)." Importance="high" />
    <PropertyGroup>
      <MinVerVersion>$(MinVerVersionOverride)</MinVerVersion>
    </PropertyGroup>
  </Target>

  <Target Name="MinVer" BeforeTargets="CoreCompile;GenerateNuspec" DependsOnTargets="MinVer_GetVersion" Condition="'$(UsingMicrosoftNETSdk)' == 'true' And '$(DesignTimeBuild)' != 'true'">
    <PropertyGroup>
      <Version>$(MinVerVersion)</Version>
      <VersionPrefix>$(MinVerVersionPrefix)</VersionPrefix>
      <VersionSuffix>$(MinVerVersionSuffix)</VersionSuffix>
      <PackageVersion>$(MinVerVersion)</PackageVersion>
    </PropertyGroup>
  </Target>

  <Target Name="MinVer_EnsureSdk" BeforeTargets="MinVer" Condition="'$(DesignTimeBuild)' != 'true'">
    <Error Condition="'$(UsingMicrosoftNETSdk)' != 'true'" Code="MINVER0001" Text="MinVer only works in SDK-style projects." />
  </Target>

</Project>
